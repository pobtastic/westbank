<!DOCTYPE html>
<html>
<head>
<title>West Bank: Routine at 55525</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../westbank.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="55472.html">55472</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55525">Map</a></td>
<td class="next">
Next: <a href="55820.html">55820</a>
</td>
</tr>
</table>
<div class="description">55525: Julius logic</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55525"></span>
<div class="comments">
<div class="paragraph">
Handles all the logic around drawing Julius and handling his "special" logic.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Good_Bad</td>
<td class="address-2"><span id="55525"></span>55525</td>
<td class="instruction">DEFB 0</td>
<td class="comment-1" rowspan="1">If this is $00 then Julius is "good". If this is $01 then he is "bad" (i.e. will draw on you).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55526"></span>55526</td>
<td class="instruction">DEFB 0</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">Julius_State_Reference</td>
<td class="address-1"><span id="55527"></span>55527</td>
<td class="instruction">DEFB 4</td>
<td class="comment-1" rowspan="1">The current character state.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_01</td>
<td class="address-1"><span id="55528"></span>55528</td>
<td class="instruction">DEFB 0</td>
<td class="comment-1" rowspan="1">Character timer 1.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_02</td>
<td class="address-1"><span id="55529"></span>55529</td>
<td class="instruction">DEFB 0</td>
<td class="comment-1" rowspan="1">Character timer 2.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_03</td>
<td class="address-1"><span id="55530"></span>55530</td>
<td class="instruction">DEFB 0</td>
<td class="comment-1" rowspan="1">Character timer 3.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_04</td>
<td class="address-1"><span id="55531"></span>55531</td>
<td class="instruction">DEFB 27</td>
<td class="comment-1" rowspan="1">Character timer 4.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_05</td>
<td class="address-1"><span id="55532"></span>55532</td>
<td class="instruction">DEFB 8</td>
<td class="comment-1" rowspan="1">Character timer 5.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_06</td>
<td class="address-1"><span id="55533"></span>55533</td>
<td class="instruction">DEFB 8</td>
<td class="comment-1" rowspan="1">Character timer 6.</td>
</tr>
<tr>
<td class="asm-label">Julius_Timer_07</td>
<td class="address-1"><span id="55534"></span>55534</td>
<td class="instruction">DEFB 128</td>
<td class="comment-1" rowspan="1">Character timer 7.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55535"></span>
<div class="comments">
<div class="paragraph">
This routine looks at the current character state and routes to the correct subroutine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_Routing</td>
<td class="address-2"><span id="55535"></span>55535</td>
<td class="instruction">LD HL,55527</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="55525.html#55527">Julius_State_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55538"></span>55538</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55539"></span>55539</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="13">Work out which routine to use based on the current state. <table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Routine</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55559">Julius_Open_01</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55574">Julius_Open_02</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55589">Julius_Open_03</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55604">Julius_Open_04</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55651">Julius_Open_05</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">6</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55666">Julius_Open_06</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">7</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55681">Julius_Open_07</a></td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55540"></span>55540</td>
<td class="instruction">JR Z,<a href="55525.html#55559">Julius_Open_01</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55542"></span>55542</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55543"></span>55543</td>
<td class="instruction">JR Z,<a href="55525.html#55574">Julius_Open_02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55545"></span>55545</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55546"></span>55546</td>
<td class="instruction">JR Z,<a href="55525.html#55589">Julius_Open_03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55548"></span>55548</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55549"></span>55549</td>
<td class="instruction">JR Z,<a href="55525.html#55604">Julius_Open_04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55551"></span>55551</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55552"></span>55552</td>
<td class="instruction">JR Z,<a href="55525.html#55651">Julius_Open_05</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55554"></span>55554</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55555"></span>55555</td>
<td class="instruction">JR Z,<a href="55525.html#55666">Julius_Open_06</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55557"></span>55557</td>
<td class="instruction">JR <a href="55525.html#55681">Julius_Open_07</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55559"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 1 countdown/ transition to door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_01</td>
<td class="address-2"><span id="55559"></span>55559</td>
<td class="instruction">LD A,(55528)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55528">Julius_Timer_01</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55562"></span>55562</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55563"></span>55563</td>
<td class="instruction">LD (55528),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55566"></span>55566</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55567"></span>55567</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55568"></span>55568</td>
<td class="instruction">LD A,36</td>
<td class="comment-1" rowspan="3">Pass character index (<a href="45632.html">stand off | 36</a>) to <a href="54884.html#54993">Draw_DoorFrame02</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55570"></span>55570</td>
<td class="instruction">CALL <a href="54884.html#54993">Draw_DoorFrame02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55573"></span>55573</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55574"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 2 countdown/ transition to door frame 3.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_02</td>
<td class="address-2"><span id="55574"></span>55574</td>
<td class="instruction">LD A,(55529)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55529">Julius_Timer_02</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55577"></span>55577</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55578"></span>55578</td>
<td class="instruction">LD (55529),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55581"></span>55581</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55582"></span>55582</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55583"></span>55583</td>
<td class="instruction">LD A,36</td>
<td class="comment-1" rowspan="3">Pass character index (<a href="45632.html">stand off | 36</a>) to <a href="54884.html#55007">Draw_DoorFrame03</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55585"></span>55585</td>
<td class="instruction">CALL <a href="54884.html#55007">Draw_DoorFrame03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55588"></span>55588</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55589"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 3 countdown/ transition to door frame 4.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_03</td>
<td class="address-2"><span id="55589"></span>55589</td>
<td class="instruction">LD A,(55530)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55530">Julius_Timer_03</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55592"></span>55592</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55593"></span>55593</td>
<td class="instruction">LD (55530),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55596"></span>55596</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55597"></span>55597</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55598"></span>55598</td>
<td class="instruction">LD A,36</td>
<td class="comment-1" rowspan="3">Pass character index (<a href="45632.html">stand off | 36</a>) to <a href="54884.html#55021">Draw_DoorFrame04</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55600"></span>55600</td>
<td class="instruction">CALL <a href="54884.html#55021">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55603"></span>55603</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55604"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 4 countdown.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_04</td>
<td class="address-2"><span id="55604"></span>55604</td>
<td class="instruction">LD DE,53213</td>
<td class="comment-1" rowspan="2">Call <a href="54691.html">Hit_Detection</a> with a callback to <a href="52920.html#53213">Init_Julius_Close</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55607"></span>55607</td>
<td class="instruction">CALL <a href="54691.html">Hit_Detection</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55610"></span>55610</td>
<td class="instruction">LD A,(55531)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55531">Julius_Timer_04</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55613"></span>55613</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55614"></span>55614</td>
<td class="instruction">LD (55531),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55617"></span>55617</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55618"></span>55618</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55619"></span>55619</td>
<td class="instruction">LD A,(55525)</td>
<td class="comment-1" rowspan="3">Jump to <a href="55525.html#55633">Julius_State_04_Close</a> if <a href="55525.html">Julius_Good_Bad</a> is zero (Julius is "good").</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55622"></span>55622</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55623"></span>55623</td>
<td class="instruction">JR Z,<a href="55525.html#55633">Julius_State_04_Close</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55625"></span>
<div class="comments">
<div class="paragraph">
Changes the frame to show Julius drawing his pistol.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55625"></span>55625</td>
<td class="instruction">LD (HL),7</td>
<td class="comment-1" rowspan="1">Writes "07" to <a href="55525.html#55527">Julius_State_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55627"></span>55627</td>
<td class="instruction">LD A,37</td>
<td class="comment-1" rowspan="3">Pass character index (<a href="45632.html#46160">draw | 37</a>) to <a href="54884.html#55021">Draw_DoorFrame04</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55629"></span>55629</td>
<td class="instruction">CALL <a href="54884.html#55021">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55632"></span>55632</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55633"></span>
<div class="comments">
<div class="paragraph">
Set up (and begin) closing the door.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_State_04_Close</td>
<td class="address-2"><span id="55633"></span>55633</td>
<td class="instruction">LD A,36</td>
<td class="comment-1" rowspan="2">Pass character index (<a href="45632.html">stand off | 36</a>) to <a href="54884.html#55007">Draw_DoorFrame03</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55635"></span>55635</td>
<td class="instruction">CALL <a href="54884.html#55007">Draw_DoorFrame03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55638"></span>55638</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="5">Writes $01 to <a href="53648.html">53648</a> and <span class="register">IX</span>+8. Writes $05 to <span class="register">IX</span>+6 and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55640"></span>55640</td>
<td class="instruction">LD (53648),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55643"></span>55643</td>
<td class="instruction">LD (IX+8),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55646"></span>55646</td>
<td class="instruction">LD (IX+6),5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55650"></span>55650</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55651"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 3 countdown/ transition to door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_05</td>
<td class="address-2"><span id="55651"></span>55651</td>
<td class="instruction">LD A,(55532)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55532">Julius_Timer_05</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55654"></span>55654</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55655"></span>55655</td>
<td class="instruction">LD (55532),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55658"></span>55658</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55659"></span>55659</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55660"></span>55660</td>
<td class="instruction">LD A,36</td>
<td class="comment-1" rowspan="3">Pass character index (<a href="45632.html">stand off | 36</a>) to <a href="54884.html#54993">Draw_DoorFrame02</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55662"></span>55662</td>
<td class="instruction">CALL <a href="54884.html#54993">Draw_DoorFrame02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55665"></span>55665</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55666"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 2 countdown/ transition to door frame 1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_06</td>
<td class="address-2"><span id="55666"></span>55666</td>
<td class="instruction">LD A,(55533)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55533">Julius_Timer_06</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55669"></span>55669</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55670"></span>55670</td>
<td class="instruction">LD (55533),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55673"></span>55673</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55674"></span>55674</td>
<td class="instruction">CALL <a href="54884.html">Draw_DoorFrame1</a></td>
<td class="comment-1" rowspan="1">Call <a href="54884.html">Draw_DoorFrame1</a> (i.e. no character/ door is shut).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55677"></span>55677</td>
<td class="instruction">CALL <a href="55457.html">Reset___</a></td>
<td class="comment-1" rowspan="1">Call <a href="55457.html">Reset___</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55680"></span>55680</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55681"></span>
<div class="comments">
<div class="paragraph">
???
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Open_07</td>
<td class="address-2"><span id="55681"></span>55681</td>
<td class="instruction">LD DE,53218</td>
<td class="comment-1" rowspan="2">Call <a href="54691.html">Hit_Detection</a> with a callback to <a href="52920.html#53218">53218</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55684"></span>55684</td>
<td class="instruction">CALL <a href="54691.html">Hit_Detection</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55687"></span>55687</td>
<td class="instruction">LD A,(55534)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55534">Julius_Timer_07</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55690"></span>55690</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55691"></span>55691</td>
<td class="instruction">LD (55534),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55694"></span>55694</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55695"></span>55695</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55696"></span>55696</td>
<td class="instruction">LD (54014),A</td>
<td class="comment-1" rowspan="1">Write $01 to <a href="53977.html#54014">54014</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55699"></span>55699</td>
<td class="instruction">CALL <a href="55457.html">Reset___</a></td>
<td class="comment-1" rowspan="1">Call <a href="55457.html">Reset___</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55702"></span>55702</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55703"></span>
<div class="comments">
<div class="paragraph">
This routine looks at the current character state and routes to the correct subroutine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_Routing</td>
<td class="address-2"><span id="55703"></span>55703</td>
<td class="instruction">LD HL,55527</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="55525.html#55527">Julius_State_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55706"></span>55706</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55707"></span>55707</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="9">Work out which routine to use based on the current state. <table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Routine</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">1</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55721">Julius_Close_01</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">2</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55736">Julius_Close_02</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">3</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55763">Julius_Close_03</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">4</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55778">Julius_Close_04</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">5</td>
<td class="centre" colspan="1" rowspan="1"><a href="55525.html#55793">Julius_Close_05</a></td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55708"></span>55708</td>
<td class="instruction">JR Z,<a href="55525.html#55721">Julius_Close_01</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55710"></span>55710</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55711"></span>55711</td>
<td class="instruction">JR Z,<a href="55525.html#55736">Julius_Close_02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55713"></span>55713</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55714"></span>55714</td>
<td class="instruction">JR Z,<a href="55525.html#55763">Julius_Close_03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55716"></span>55716</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55717"></span>55717</td>
<td class="instruction">JR Z,<a href="55525.html#55778">Julius_Close_04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55719"></span>55719</td>
<td class="instruction">JR <a href="55525.html#55793">Julius_Close_05</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55721"></span>
<div class="comments">
<div class="paragraph">
Handles state countdown/ transition to character frame <a href="45632.html#46688">$26</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_01</td>
<td class="address-2"><span id="55721"></span>55721</td>
<td class="instruction">LD A,(55528)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55528">Julius_Timer_01</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55724"></span>55724</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55725"></span>55725</td>
<td class="instruction">LD (55528),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55728"></span>55728</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55729"></span>55729</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55730"></span>55730</td>
<td class="instruction">LD A,38</td>
<td class="comment-1" rowspan="3">Pass character index <a href="45632.html#46688">shot | 38</a> to <a href="54884.html#55021">Draw_DoorFrame04</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55732"></span>55732</td>
<td class="instruction">CALL <a href="54884.html#55021">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55735"></span>55735</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55736"></span>
<div class="comments">
<div class="paragraph">
Handles state countdown/ transition to character frame <a href="45632.html#47216">$27</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_02</td>
<td class="address-2"><span id="55736"></span>55736</td>
<td class="instruction">LD A,(55529)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55529">Julius_Timer_02</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55739"></span>55739</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55740"></span>55740</td>
<td class="instruction">LD (55529),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55743"></span>55743</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55744"></span>55744</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55745"></span>55745</td>
<td class="instruction">LD A,39</td>
<td class="comment-1" rowspan="2">Pass character index <a href="45632.html#47216">floor | 39</a> to <a href="54884.html#55021">Draw_DoorFrame04</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55747"></span>55747</td>
<td class="instruction">CALL <a href="54884.html#55021">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55750"></span>55750</td>
<td class="instruction">LD A,(55526)</td>
<td class="comment-1" rowspan="3">Return if <a href="55525.html#55526">55526</a> is zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55753"></span>55753</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55754"></span>55754</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55755"></span>55755</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Else write <a href="55525.html#55526">55526</a>+1 to <a href="53977.html#54014">54014</a>, call <a href="55457.html">Reset___</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55756"></span>55756</td>
<td class="instruction">LD (54014),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55759"></span>55759</td>
<td class="instruction">CALL <a href="55457.html">Reset___</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55762"></span>55762</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55763"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 4 countdown/ transition to door frame 3.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_03</td>
<td class="address-2"><span id="55763"></span>55763</td>
<td class="instruction">LD A,(55530)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55530">Julius_Timer_03</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55766"></span>55766</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55767"></span>55767</td>
<td class="instruction">LD (55530),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55770"></span>55770</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55771"></span>55771</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55772"></span>55772</td>
<td class="instruction">LD A,39</td>
<td class="comment-1" rowspan="3">Pass character index <a href="45632.html#47216">floor | 39</a> to <a href="54884.html#55007">Draw_DoorFrame03</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55774"></span>55774</td>
<td class="instruction">CALL <a href="54884.html#55007">Draw_DoorFrame03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55777"></span>55777</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55778"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 3 countdown/ transition to door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_04</td>
<td class="address-2"><span id="55778"></span>55778</td>
<td class="instruction">LD A,(55531)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55531">Julius_Timer_04</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55781"></span>55781</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55782"></span>55782</td>
<td class="instruction">LD (55531),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55785"></span>55785</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55786"></span>55786</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55787"></span>55787</td>
<td class="instruction">LD A,39</td>
<td class="comment-1" rowspan="3">Pass character index <a href="45632.html#47216">floor | 39</a> to <a href="54884.html#54993">Draw_DoorFrame02</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55789"></span>55789</td>
<td class="instruction">CALL <a href="54884.html#54993">Draw_DoorFrame02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55792"></span>55792</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="55793"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 2 countdown/ transition to door frame 1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Julius_Close_05</td>
<td class="address-2"><span id="55793"></span>55793</td>
<td class="instruction">LD A,(55532)</td>
<td class="comment-1" rowspan="4">Decrease <a href="55525.html#55532">Julius_Timer_05</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55796"></span>55796</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55797"></span>55797</td>
<td class="instruction">LD (55532),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55800"></span>55800</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55801"></span>55801</td>
<td class="instruction">CALL <a href="54884.html">Draw_DoorFrame1</a></td>
<td class="comment-1" rowspan="1">Call <a href="54884.html">Draw_DoorFrame1</a> (i.e. no character/ door is shut).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55804"></span>55804</td>
<td class="instruction">CALL <a href="55457.html">Reset___</a></td>
<td class="comment-1" rowspan="1">Call <a href="55457.html">Reset___</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55807"></span>55807</td>
<td class="instruction">LD A,1</td>
<td class="comment-1" rowspan="5">Writes $01 to <a href="53648.html">53648</a> and <span class="register">IX</span>+8. Writes $05 to <span class="register">IX</span>+6 and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55809"></span>55809</td>
<td class="instruction">LD (53648),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55812"></span>55812</td>
<td class="instruction">LD (IX+8),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55815"></span>55815</td>
<td class="instruction">LD (IX+6),5</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="55819"></span>55819</td>
<td class="instruction">RET</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="55472.html">55472</a>
</td>
<td class="up">Up: <a href="../maps/all.html#55525">Map</a></td>
<td class="next">
Next: <a href="55820.html">55820</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; DINAMIC SOFTWARE 1985 &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../../asm/D8E5.html">Switch to hexadecimal</a>.</div>
</footer>
</body>
</html>