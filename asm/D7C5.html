<!DOCTYPE html>
<html>
<head>
<title>West Bank: Routine at D7C5</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../westbank.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="D71E.html">D71E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#d7c5">Map</a></td>
<td class="next">
Next: <a href="D8A1.html">D8A1</a>
</td>
</tr>
</table>
<div class="description">D7C5: Bowie logic</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Handles all the logic around drawing Bowie and handling his "special" logic.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d7c5"></span>
<div class="comments">
<div class="paragraph">
Bowie state variables/ flags.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Good_Bad</td>
<td class="address-2"><span id="d7c5"></span>D7C5</td>
<td class="instruction">DEFB $01</td>
<td class="comment-1" rowspan="1">If this is $00 then Bowie is "good". If this is $01 then he is "bad" (i.e. there's a bomb under his hat).</td>
</tr>
<tr>
<td class="asm-label">Bowie_Frame_Reference</td>
<td class="address-1"><span id="d7c6"></span>D7C6</td>
<td class="instruction">DEFB $22</td>
<td class="comment-1" rowspan="1">The current character frame index reference.</td>
</tr>
<tr>
<td class="asm-label">Bowie_State_Reference</td>
<td class="address-1"><span id="d7c7"></span>D7C7</td>
<td class="instruction">DEFB $06</td>
<td class="comment-1" rowspan="1">The current character state.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_01</td>
<td class="address-1"><span id="d7c8"></span>D7C8</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 1.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_02</td>
<td class="address-1"><span id="d7c9"></span>D7C9</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 2.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_03</td>
<td class="address-1"><span id="d7ca"></span>D7CA</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 3.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_04</td>
<td class="address-1"><span id="d7cb"></span>D7CB</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 4.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_05</td>
<td class="address-1"><span id="d7cc"></span>D7CC</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 5.</td>
</tr>
<tr>
<td class="asm-label">Bowie_Timer_06</td>
<td class="address-1"><span id="d7cd"></span>D7CD</td>
<td class="instruction">DEFB $00</td>
<td class="comment-1" rowspan="1">Character timer 6.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d7ce"></span>
<div class="comments">
<div class="paragraph">
This routine looks at the current character state and routes to the correct subroutine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Routing</td>
<td class="address-2"><span id="d7ce"></span>D7CE</td>
<td class="instruction">LD HL,$D7C7</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D7C5.html#d7c7">Bowie_State_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d1"></span>D7D1</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d2"></span>D7D2</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="11">Work out which routine to jump to based on the current state. <table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Routine</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">01</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d7e3">Bowie_Open_01</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">02</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d7f2">Bowie_Open_02</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">03</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d801">Bowie_Open_03</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">04</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d810">Bowie_Open_04</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">05</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d82c">Bowie_Close_02</a></td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">06</td>
<td class="centre" colspan="1" rowspan="1"><a href="D7C5.html#d83c">Bowie_Close_01</a></td>
</tr>
</table></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d3"></span>D7D3</td>
<td class="instruction">JR Z,<a href="D7C5.html#d7e3">Bowie_Open_01</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d5"></span>D7D5</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d6"></span>D7D6</td>
<td class="instruction">JR Z,<a href="D7C5.html#d7f2">Bowie_Open_02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d8"></span>D7D8</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7d9"></span>D7D9</td>
<td class="instruction">JR Z,<a href="D7C5.html#d801">Bowie_Open_03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7db"></span>D7DB</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7dc"></span>D7DC</td>
<td class="instruction">JR Z,<a href="D7C5.html#d810">Bowie_Open_04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7de"></span>D7DE</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7df"></span>D7DF</td>
<td class="instruction">JR Z,<a href="D7C5.html#d82c">Bowie_Close_02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7e1"></span>D7E1</td>
<td class="instruction">JR <a href="D7C5.html#d83c">Bowie_Close_01</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d7e3"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 1 countdown/ transition to door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Open_01</td>
<td class="address-2"><span id="d7e3"></span>D7E3</td>
<td class="instruction">LD A,($D7C8)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7c8">Bowie_Timer_01</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7e6"></span>D7E6</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7e7"></span>D7E7</td>
<td class="instruction">LD ($D7C8),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7ea"></span>D7EA</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7eb"></span>D7EB</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7ec"></span>D7EC</td>
<td class="instruction">LD A,$1B</td>
<td class="comment-1" rowspan="3">Pass character index <a href="9FB0.html">$1B</a> to <a href="D664.html#d6d1">Draw_DoorFrame02</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7ee"></span>D7EE</td>
<td class="instruction">CALL <a href="D664.html#d6d1">Draw_DoorFrame02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7f1"></span>D7F1</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d7f2"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 2 countdown/ transition to door frame 3.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Open_02</td>
<td class="address-2"><span id="d7f2"></span>D7F2</td>
<td class="instruction">LD A,($D7C9)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7c9">Bowie_Timer_02</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7f5"></span>D7F5</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7f6"></span>D7F6</td>
<td class="instruction">LD ($D7C9),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7f9"></span>D7F9</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7fa"></span>D7FA</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7fb"></span>D7FB</td>
<td class="instruction">LD A,$1B</td>
<td class="comment-1" rowspan="3">Pass character index <a href="9FB0.html">$1B</a> to <a href="D664.html#d6df">Draw_DoorFrame03</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d7fd"></span>D7FD</td>
<td class="instruction">CALL <a href="D664.html#d6df">Draw_DoorFrame03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d800"></span>D800</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d801"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 3 countdown/ transition to door frame 4.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Open_03</td>
<td class="address-2"><span id="d801"></span>D801</td>
<td class="instruction">LD A,($D7CA)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7ca">Bowie_Timer_03</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d804"></span>D804</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d805"></span>D805</td>
<td class="instruction">LD ($D7CA),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d808"></span>D808</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d809"></span>D809</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d80a"></span>D80A</td>
<td class="instruction">LD A,$1B</td>
<td class="comment-1" rowspan="3">Pass character frame index <a href="9FB0.html">$1B</a> to <a href="D664.html#d6ed">Draw_DoorFrame04</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d80c"></span>D80C</td>
<td class="instruction">CALL <a href="D664.html#d6ed">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d80f"></span>D80F</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d810"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 4 countdown/ transition to door frame 3.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Open_04</td>
<td class="address-2"><span id="d810"></span>D810</td>
<td class="instruction">LD E,(IX+$04)</td>
<td class="comment-1" rowspan="3">Call <a href="D5A3.html">Hit_Detection</a> with a callback to either <a href="D7C5.html#d84b">Bowie_Cash_Action</a> or <a href="D7C5.html#d85d">Bowie_Bomb_Action</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d813"></span>D813</td>
<td class="instruction">LD D,(IX+$05)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d816"></span>D816</td>
<td class="instruction">CALL <a href="D5A3.html">Hit_Detection</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d819"></span>D819</td>
<td class="instruction">LD A,($D7CB)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7cb">Bowie_Timer_04</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d81c"></span>D81C</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d81d"></span>D81D</td>
<td class="instruction">LD ($D7CB),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d820"></span>D820</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label">Bowie_Close_03</td>
<td class="address-2"><span id="d821"></span>D821</td>
<td class="instruction">LD HL,$D7C7</td>
<td class="comment-1" rowspan="2">Move onto next character state (<a href="D7C5.html#d7c7">Bowie_State_Reference</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d824"></span>D824</td>
<td class="instruction">INC (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d825"></span>D825</td>
<td class="instruction">LD A,($D7C6)</td>
<td class="comment-1" rowspan="3">Load the character frame index from <a href="D7C5.html#d7c6">Bowie_Frame_Reference</a>, pass it to <a href="D664.html#d6df">Draw_DoorFrame03</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d828"></span>D828</td>
<td class="instruction">CALL <a href="D664.html#d6df">Draw_DoorFrame03</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d82b"></span>D82B</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d82c"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 3 countdown/ transition to door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Close_02</td>
<td class="address-2"><span id="d82c"></span>D82C</td>
<td class="instruction">LD A,($D7CC)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7cc">Bowie_Timer_05</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d82f"></span>D82F</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d830"></span>D830</td>
<td class="instruction">LD ($D7CC),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d833"></span>D833</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d834"></span>D834</td>
<td class="instruction">INC (HL)</td>
<td class="comment-1" rowspan="1">Move onto next character state.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d835"></span>D835</td>
<td class="instruction">LD A,($D7C6)</td>
<td class="comment-1" rowspan="3">Load the character frame index from <a href="D7C5.html#d7c6">Bowie_Frame_Reference</a>, pass it to <a href="D664.html#d6d1">Draw_DoorFrame02</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d838"></span>D838</td>
<td class="instruction">CALL <a href="D664.html#d6d1">Draw_DoorFrame02</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d83b"></span>D83B</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d83c"></span>
<div class="comments">
<div class="paragraph">
Handle door frame 2 countdown/ transition to door frame 1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Close_01</td>
<td class="address-2"><span id="d83c"></span>D83C</td>
<td class="instruction">LD A,($D7CD)</td>
<td class="comment-1" rowspan="4">Decrease <a href="D7C5.html#d7cd">Bowie_Timer_06</a> by one, return if result is not zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d83f"></span>D83F</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d840"></span>D840</td>
<td class="instruction">LD ($D7CD),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d843"></span>D843</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d844"></span>D844</td>
<td class="instruction">CALL <a href="D664.html">Draw_DoorFrame1</a></td>
<td class="comment-1" rowspan="1">Call <a href="D664.html">Draw_DoorFrame1</a> (i.e. no character/ door is shut).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d847"></span>D847</td>
<td class="instruction">CALL <a href="D8A1.html">Reset___</a></td>
<td class="comment-1" rowspan="1">Call <a href="D8A1.html">Reset___</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d84a"></span>D84A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d84b"></span>
<div class="comments">
<div class="paragraph">
Handles marking this as something shootable.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Cash_Action</td>
<td class="address-1"><span id="d84b"></span>D84B</td>
<td class="instruction">LD (IX+$06),$05</td>
<td class="comment-1" rowspan="2">Writes $05 to <span class="register">IX</span>+$06 and $01 to <span class="register">IX</span>+$07.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d84f"></span>D84F</td>
<td class="instruction">LD (IX+$07),$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d853"></span>D853</td>
<td class="instruction">LD A,$01</td>
<td class="comment-1" rowspan="3">Writes $01 to <span class="register">IX</span>+$08 and <a href="D190.html">D190</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d855"></span>D855</td>
<td class="instruction">LD (IX+$08),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d858"></span>D858</td>
<td class="instruction">LD ($D190),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d85b"></span>D85B</td>
<td class="instruction">JR <a href="D7C5.html#d821">Bowie_Close_03</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="D7C5.html#d821">Bowie_Close_03</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d85d"></span>
<div class="comments">
<div class="paragraph">
Handles marking this as something unshootable.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Bomb_Action</td>
<td class="address-1"><span id="d85d"></span>D85D</td>
<td class="instruction">LD A,$05</td>
<td class="comment-1" rowspan="3">Writes $05 to <a href="D2D9.html#d2fe">D2FE</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d85f"></span>D85F</td>
<td class="instruction">LD ($D2FE),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d862"></span>D862</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d863"></span>
<div class="comments">
<div class="paragraph">
Handles both shooting the hats off Bowie's head, and checking/ routing on the last frame for the "surprise".
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Shot_Action</td>
<td class="address-1"><span id="d863"></span>D863</td>
<td class="instruction">LD HL,$D7C6</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D7C5.html#d7c6">Bowie_Frame_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d866"></span>D866</td>
<td class="instruction">LD A,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d867"></span>D867</td>
<td class="instruction">CP $21</td>
<td class="comment-1" rowspan="1">Is it character frame reference (<a href="9FB0.html#ac10">1 hat | 21</a>)?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d869"></span>D869</td>
<td class="instruction">LD (IX+$06),$01</td>
<td class="comment-1" rowspan="1">Writes $01 to <span class="register">IX</span>+$06.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d86d"></span>D86D</td>
<td class="instruction">JR NC,<a href="D7C5.html#d875">Bowie_Check</a></td>
<td class="comment-1" rowspan="1">If Bowie is on the last frame then jump forward to <a href="D7C5.html#d875">Bowie_Check</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d86f"></span>D86F</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="4">Else update <a href="D7C5.html#d7c6">Bowie_Frame_Reference</a> to point at the next frame, call <a href="D664.html#d6ed">Draw_DoorFrame04</a> and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d870"></span>D870</td>
<td class="instruction">LD (HL),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d871"></span>D871</td>
<td class="instruction">CALL <a href="D664.html#d6ed">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d874"></span>D874</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d875"></span>
<div class="comments">
<div class="paragraph">
Checks the "good/ bad" flag and routes the gameplay accordingly.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_Check</td>
<td class="address-2"><span id="d875"></span>D875</td>
<td class="instruction">LD A,($D7C5)</td>
<td class="comment-1" rowspan="3">If <a href="D7C5.html">Bowie_Good_Bad</a> is zero jump to <a href="D7C5.html#d87d">Bowie_State_Cash</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d878"></span>D878</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d879"></span>D879</td>
<td class="instruction">JR Z,<a href="D7C5.html#d87d">Bowie_State_Cash</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d87b"></span>D87B</td>
<td class="instruction">JR <a href="D7C5.html#d88f">Bowie_State_Bomb</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="D7C5.html#d88f">Bowie_State_Bomb</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d87d"></span>
<div class="comments">
<div class="paragraph">
Handle displaying cash character frame.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_State_Cash</td>
<td class="address-2"><span id="d87d"></span>D87D</td>
<td class="instruction">LD A,$23</td>
<td class="comment-1" rowspan="3">Writes character frame reference <a href="9FB0.html#b030">cash | 23</a> to <a href="D7C5.html#d7c6">Bowie_Frame_Reference</a>, and pass it to <a href="D664.html#d6ed">Draw_DoorFrame04</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d87f"></span>D87F</td>
<td class="instruction">LD ($D7C6),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d882"></span>D882</td>
<td class="instruction">CALL <a href="D664.html#d6ed">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d885"></span>D885</td>
<td class="instruction">LD HL,$D84B</td>
<td class="comment-1" rowspan="3">Writes <a href="D7C5.html#d84b">Bowie_Cash_Action</a> to the current door flags (e.g. <a href="D165.html#d169">Door_Bowie_Action_01</a>, <a href="D173.html#d177">Door_Bowie_Action_02</a> or <a href="D181.html#d185">Door_Bowie_Action_03</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d888"></span>D888</td>
<td class="instruction">LD (IX+$04),L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d88b"></span>D88B</td>
<td class="instruction">LD (IX+$05),H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d88e"></span>D88E</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d88f"></span>
<div class="comments">
<div class="paragraph">
Handle displaying bomb character frame.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Bowie_State_Bomb</td>
<td class="address-2"><span id="d88f"></span>D88F</td>
<td class="instruction">LD A,$22</td>
<td class="comment-1" rowspan="3">Writes character frame reference <a href="9FB0.html#ae20">bomb | 22</a> to <a href="D7C5.html#d7c6">Bowie_Frame_Reference</a>, and pass it to <a href="D664.html#d6ed">Draw_DoorFrame04</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d891"></span>D891</td>
<td class="instruction">LD ($D7C6),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d894"></span>D894</td>
<td class="instruction">CALL <a href="D664.html#d6ed">Draw_DoorFrame04</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d897"></span>D897</td>
<td class="instruction">LD HL,$D85D</td>
<td class="comment-1" rowspan="3">Writes <a href="D7C5.html#d85d">Bowie_Bomb_Action</a> to the current door flags (e.g. <a href="D165.html#d169">Door_Bowie_Action_01</a>, <a href="D173.html#d177">Door_Bowie_Action_02</a> or <a href="D181.html#d185">Door_Bowie_Action_03</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d89a"></span>D89A</td>
<td class="instruction">LD (IX+$04),L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d89d"></span>D89D</td>
<td class="instruction">LD (IX+$05),H</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d8a0"></span>D8A0</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="D71E.html">D71E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#d7c5">Map</a></td>
<td class="next">
Next: <a href="D8A1.html">D8A1</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; DINAMIC SOFTWARE 1985 &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../dec/asm/55237.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>