<!DOCTYPE html>
<html>
<head>
<title>West Bank: Routine at D664</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../westbank.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="D61E.html">D61E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#d664">Map</a></td>
<td class="next">
Next: <a href="D71E.html">D71E</a>
</td>
</tr>
</table>
<div class="description">D664: Draw Doors</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="CC3A.html">Draw_PlayWithDoors</a>, <a href="D48F.html">Customer_Frame_01</a>, <a href="D71E.html">Bandit_State_Reference</a>, <a href="D7C5.html">Bowie_Good_Bad</a>, <a href="D8E5.html">Julius_Good_Bad</a> and <a href="DA0C.html">Bandit_Draw</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d664"></span>
<div class="comments">
<div class="paragraph">
Preps door frame 1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Draw_DoorFrame1</td>
<td class="address-2"><span id="d664"></span>D664</td>
<td class="instruction">LD HL,$D6B1</td>
<td class="comment-1" rowspan="2">Calls <a href="D664.html#d684">Door_Attributes</a> using <a href="D664.html#d6b1">Door_Attributes_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d667"></span>D667</td>
<td class="instruction">CALL <a href="D664.html#d684">Door_Attributes</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d66a"></span>D66A</td>
<td class="instruction">LD DE,$BA80</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="BA80.html">Door_Frame_01</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d66d"></span>
<div class="comments">
<div class="paragraph">
Referencing the door frame index, work out the screen position and send it to the <a href="D664.html#d717">Draw_DoorFrame</a> routine.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Prep_Door_Frame</td>
<td class="address-2"><span id="d66d"></span>D66D</td>
<td class="instruction">LD A,($CE1A)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="CE1A.html">Door_Frame_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d670"></span>D670</td>
<td class="instruction">LD HL,$4082</td>
<td class="comment-1" rowspan="8">Determines which screen address to use for the door reference index currently held in <span class="register">A</span>. <table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Screen Address</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">01</td>
<td class="centre" colspan="1" rowspan="1">$4082</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">02</td>
<td class="centre" colspan="1" rowspan="1">$408D</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">03</td>
<td class="centre" colspan="1" rowspan="1">$4098</td>
</tr>
</table> Jump to <a href="D664.html#d717">Draw_DoorFrame</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d673"></span>D673</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d674"></span>D674</td>
<td class="instruction">JP Z,<a href="D664.html#d717">Draw_DoorFrame</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d677"></span>D677</td>
<td class="instruction">LD HL,$408D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d67a"></span>D67A</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d67b"></span>D67B</td>
<td class="instruction">JP Z,<a href="D664.html#d717">Draw_DoorFrame</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d67e"></span>D67E</td>
<td class="instruction">LD HL,$4098</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d681"></span>D681</td>
<td class="instruction">JP <a href="D664.html#d717">Draw_DoorFrame</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d684"></span>
<div class="comments">
<div class="paragraph">
Copies attributes for the current door frame index.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes</td>
<td class="address-2"><span id="d684"></span>D684</td>
<td class="instruction">PUSH AF</td>
<td class="comment-1" rowspan="1">Stash the accumulator for later.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d685"></span>D685</td>
<td class="instruction">LD A,($CE1A)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="CE1A.html">Door_Frame_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d688"></span>D688</td>
<td class="instruction">LD DE,$5882</td>
<td class="comment-1" rowspan="7"><table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Screen Address</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">01</td>
<td class="centre" colspan="1" rowspan="1">$5882</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">02</td>
<td class="centre" colspan="1" rowspan="1">$588D</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">03</td>
<td class="centre" colspan="1" rowspan="1">$5898</td>
</tr>
</table> ...continue from <a href="D664.html#d697">Door_Attributes_Skip</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d68b"></span>D68B</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d68c"></span>D68C</td>
<td class="instruction">JR Z,<a href="D664.html#d697">Door_Attributes_Skip</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d68e"></span>D68E</td>
<td class="instruction">LD DE,$588D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d691"></span>D691</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d692"></span>D692</td>
<td class="instruction">JR Z,<a href="D664.html#d697">Door_Attributes_Skip</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d694"></span>D694</td>
<td class="instruction">LD DE,$5898</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_Skip</td>
<td class="address-2"><span id="d697"></span>D697</td>
<td class="instruction">LD B,$0B</td>
<td class="comment-1" rowspan="1">Sets the height of the door image.</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_Loop</td>
<td class="address-2"><span id="d699"></span>D699</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="4">Stash the references for later and call <a href="D664.html#d6ab">Door_Attributes_Copy</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d69a"></span>D69A</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d69b"></span>D69B</td>
<td class="instruction">PUSH DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d69c"></span>D69C</td>
<td class="instruction">CALL <a href="D664.html#d6ab">Door_Attributes_Copy</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d69f"></span>D69F</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="4">Moves the screen attribute address down to the next attribute row.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a0"></span>D6A0</td>
<td class="instruction">LD HL,$0020</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a3"></span>D6A3</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a4"></span>D6A4</td>
<td class="instruction">EX DE,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a5"></span>D6A5</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="3">Restore the counter and loop back to <a href="D664.html#d699">Door_Attributes_Loop</a> until complete.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a6"></span>D6A6</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a7"></span>D6A7</td>
<td class="instruction">DJNZ <a href="D664.html#d699">Door_Attributes_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6a9"></span>D6A9</td>
<td class="instruction">POP AF</td>
<td class="comment-1" rowspan="2">Restore the accumulator and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6aa"></span>D6AA</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d6ab"></span>
<div class="comments">
<div class="paragraph">
Simple helper copy routine for sending attribute data to the screen attribute buffer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_Copy</td>
<td class="address-2"><span id="d6ab"></span>D6AB</td>
<td class="instruction">LD BC,$0007</td>
<td class="comment-1" rowspan="3">Set the door width, copy the attribute data to the screen and return.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6ae"></span>D6AE</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6b0"></span>D6B0</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d6b1"></span>
<div class="comments">
<div class="paragraph">
Door frame attribute data.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_01</td>
<td class="address-1"><span id="d6b1"></span>D6B1</td>
<td class="instruction">DEFB $30,$30,$30,$30,$30,$30,$30,$30</td>
<td class="comment-1" rowspan="1">Attribute data for door frame 1.</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_02</td>
<td class="address-1"><span id="d6b9"></span>D6B9</td>
<td class="instruction">DEFB $28,$28,$30,$30,$30,$30,$30,$30</td>
<td class="comment-1" rowspan="1">Attribute data for door frame 2.</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_03</td>
<td class="address-1"><span id="d6c1"></span>D6C1</td>
<td class="instruction">DEFB $28,$28,$28,$28,$30,$30,$30,$30</td>
<td class="comment-1" rowspan="1">Attribute data for door frame 3.</td>
</tr>
<tr>
<td class="asm-label">Door_Attributes_04</td>
<td class="address-1"><span id="d6c9"></span>D6C9</td>
<td class="instruction">DEFB $28,$28,$28,$28,$28,$28,$30,$28</td>
<td class="comment-1" rowspan="1">Attribute data for door frame 4.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d6d1"></span>
<div class="comments">
<div class="paragraph">
Preps door frame 2.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Draw_DoorFrame02</td>
<td class="address-2"><span id="d6d1"></span>D6D1</td>
<td class="instruction">LD HL,$D6B9</td>
<td class="comment-1" rowspan="2">Calls <a href="D664.html#d684">Door_Attributes</a> using <a href="D664.html#d6b9">Door_Attributes_02</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6d4"></span>D6D4</td>
<td class="instruction">CALL <a href="D664.html#d684">Door_Attributes</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6d7"></span>D6D7</td>
<td class="instruction">CALL <a href="D61E.html">Character_Door_Frame_02</a></td>
<td class="comment-1" rowspan="3">Prepare the character/ door image by calling <a href="D61E.html">Character_Door_Frame_02</a>. Then pass <a href="EA90.html">Door_Buffer</a> to <a href="D664.html#d66d">Prep_Door_Frame</a> which will draw it to the screen.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6da"></span>D6DA</td>
<td class="instruction">LD DE,$EA90</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6dd"></span>D6DD</td>
<td class="instruction">JR <a href="D664.html#d66d">Prep_Door_Frame</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d6df"></span>
<div class="comments">
<div class="paragraph">
Preps door frame 3.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Draw_DoorFrame03</td>
<td class="address-2"><span id="d6df"></span>D6DF</td>
<td class="instruction">LD HL,$D6C1</td>
<td class="comment-1" rowspan="2">Calls <a href="D664.html#d684">Door_Attributes</a> using <a href="D664.html#d6c1">Door_Attributes_03</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6e2"></span>D6E2</td>
<td class="instruction">CALL <a href="D664.html#d684">Door_Attributes</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6e5"></span>D6E5</td>
<td class="instruction">CALL <a href="D61E.html#d638">Character_Door_Frame_03</a></td>
<td class="comment-1" rowspan="3">Prepare the character/ door image by calling <a href="D61E.html#d638">Character_Door_Frame_03</a>. Then pass <a href="EA90.html">Door_Buffer</a> to <a href="D664.html#d66d">Prep_Door_Frame</a> which will draw it to the screen.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6e8"></span>D6E8</td>
<td class="instruction">LD DE,$EA90</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6eb"></span>D6EB</td>
<td class="instruction">JR <a href="D664.html#d66d">Prep_Door_Frame</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="d6ed"></span>
<div class="comments">
<div class="paragraph">
Preps door frame 4.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Draw_DoorFrame04</td>
<td class="address-2"><span id="d6ed"></span>D6ED</td>
<td class="instruction">LD HL,$D6C9</td>
<td class="comment-1" rowspan="2">Calls <a href="D664.html#d684">Door_Attributes</a> using <a href="D664.html#d6c9">Door_Attributes_04</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6f0"></span>D6F0</td>
<td class="instruction">CALL <a href="D664.html#d684">Door_Attributes</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6f3"></span>D6F3</td>
<td class="instruction">CALL <a href="D5CA.html">Draw_CharacterInDoorway</a></td>
<td class="comment-1" rowspan="1">The door is fully open so draw the whole character in the doorway directly.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6f6"></span>D6F6</td>
<td class="instruction">LD B,$58</td>
<td class="comment-1" rowspan="3">Reference <a href="BFA8.html">Door_Frame_04</a> and the dimensions for the copy routine.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6f8"></span>D6F8</td>
<td class="instruction">LD C,$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6fa"></span>D6FA</td>
<td class="instruction">LD DE,$BFA8</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d6fd"></span>D6FD</td>
<td class="instruction">LD A,($CE1A)</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=<a href="CE1A.html">Door_Frame_Reference</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d700"></span>D700</td>
<td class="instruction">LD HL,$4088</td>
<td class="comment-1" rowspan="8">Determines which screen address to use for the door reference index currently held in <span class="register">A</span>. <table class="default">
<tr>
<th colspan="1" rowspan="1"><span class="register">A</span></th>
<th colspan="1" rowspan="1">Screen Address</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">01</td>
<td class="centre" colspan="1" rowspan="1">$4088</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">02</td>
<td class="centre" colspan="1" rowspan="1">$4093</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1">03</td>
<td class="centre" colspan="1" rowspan="1">$409E</td>
</tr>
</table> Jump to <a href="D5E6.html">Copy_Routine</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d703"></span>D703</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d704"></span>D704</td>
<td class="instruction">JP Z,<a href="D5E6.html">Copy_Routine</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d707"></span>D707</td>
<td class="instruction">LD HL,$4093</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d70a"></span>D70A</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d70b"></span>D70B</td>
<td class="instruction">JP Z,<a href="D5E6.html">Copy_Routine</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d70e"></span>D70E</td>
<td class="instruction">LD HL,$409E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d711"></span>D711</td>
<td class="instruction">JP <a href="D5E6.html">Copy_Routine</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d714"></span>D714</td>
<td class="instruction">LD DE,$EA90</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="EA90.html">Door_Buffer</a>.</td>
</tr>
<tr>
<td class="asm-label">Draw_DoorFrame</td>
<td class="address-2"><span id="d717"></span>D717</td>
<td class="instruction">LD B,$58</td>
<td class="comment-1" rowspan="3">Draws the image pointed at by <span class="register">DE</span> to the screen address in <span class="register">HL</span> using <a href="D5E6.html">Copy_Routine</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d719"></span>D719</td>
<td class="instruction">LD C,$07</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="d71b"></span>D71B</td>
<td class="instruction">JP <a href="D5E6.html">Copy_Routine</a></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="D61E.html">D61E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#d664">Map</a></td>
<td class="next">
Next: <a href="D71E.html">D71E</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; DINAMIC SOFTWARE 1985 &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../dec/asm/54884.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>