<!DOCTYPE html>
<html>
<head>
<title>West Bank: Routine at CC9B</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../westbank.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CC99.html">CC99</a>
</td>
<td class="up">Up: <a href="../maps/all.html#cc9b">Map</a></td>
<td class="next">
Next: <a href="CD1B.html">CD1B</a>
</td>
</tr>
</table>
<div class="description">CC9B: Draws Deposit Cashboxes</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="C9B7.html">Prep_Display_Phase</a> and <a href="CAE7.html">CAE7</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="cc9b"></span>CC9B</td>
<td class="instruction">LD A,($D45C)</td>
<td class="comment-1" rowspan="5">Converts <a href="D45C.html">CashboxReference_Inactive</a> into cash deposit box flag address (e.g. "01" becomes <a href="CC8D.html">DoorDeposited_01</a> and so on).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cc9e"></span>CC9E</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cc9f"></span>CC9F</td>
<td class="instruction">LD H,$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cca1"></span>CCA1</td>
<td class="instruction">LD DE,$CC8C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cca4"></span>CCA4</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cca5"></span>CCA5</td>
<td class="instruction">LD IX,$D165</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D165.html#d16d">Door_Cash_Action_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cca9"></span>CCA9</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccac"></span>CCAC</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccad"></span>CCAD</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccae"></span>CCAE</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccaf"></span>CCAF</td>
<td class="instruction">LD IX,$D173</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D173.html#d17b">Door_Cash_Action_02</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccb3"></span>CCB3</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccb6"></span>CCB6</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccb7"></span>CCB7</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccb8"></span>CCB8</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccb9"></span>CCB9</td>
<td class="instruction">LD IX,$D181</td>
<td class="comment-1" rowspan="2"><span class="register">A</span>=<a href="D181.html#d189">Door_Cash_Action_03</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccbd"></span>CCBD</td>
<td class="instruction">LD A,(IX+$08)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc0"></span>CCC0</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc1"></span>CCC1</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc2"></span>CCC2</td>
<td class="instruction">LD DE,$CC99</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=<a href="CC99.html">DoorDeposited_01_06</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc5"></span>CCC5</td>
<td class="instruction">LD HL,$CC8D</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=<a href="CC8D.html">DoorDeposited_01</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc8"></span>CCC8</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Fetch the flag for <a href="CC99.html">DoorDeposited_01_06</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccc9"></span>CCC9</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Run a logical OR against the contents of <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccca"></span>CCCA</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Writes this back into <span class="register">HL</span> (setting the flag).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cccb"></span>CCCB</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cccc"></span>CCCC</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="1">Move onto <a href="CC99.html#cc9a">DoorDeposited_07_12</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cccd"></span>CCCD</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="1">Fetch the flag for <a href="CC99.html#cc9a">DoorDeposited_07_12</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccce"></span>CCCE</td>
<td class="instruction">OR (HL)</td>
<td class="comment-1" rowspan="1">Run a logical OR against the contents of <span class="register">HL</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cccf"></span>CCCF</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="1">Writes this back into <span class="register">HL</span> (setting the flag).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccd0"></span>CCD0</td>
<td class="instruction">CALL <a href="CC9B.html#ccfb">Draw_GameCashboxes</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label">Cashboxescomplete</td>
<td class="address-1"><span id="ccd3"></span>CCD3</td>
<td class="instruction">LD DE,$CC8D</td>
<td class="comment-1" rowspan="1">Points to the cashbox flags (beginning at <a href="CC8D.html">DoorDeposited_01</a>).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccd6"></span>CCD6</td>
<td class="instruction">LD HL,$CA80</td>
<td class="comment-1" rowspan="2">Write $00 to <a href="C9B7.html#ca80">Cashboxes_Completed_Flag</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccd9"></span>CCD9</td>
<td class="instruction">LD (HL),$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccdb"></span>CCDB</td>
<td class="instruction">LD B,$0C</td>
<td class="comment-1" rowspan="1">Testing against all 12 cashboxes.</td>
</tr>
<tr>
<td class="asm-label">Cashboxescomplete_Loop</td>
<td class="address-2"><span id="ccdd"></span>CCDD</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="3">Fetch the cashbox flag, return if its zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccde"></span>CCDE</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccdf"></span>CCDF</td>
<td class="instruction">RET Z</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce0"></span>CCE0</td>
<td class="instruction">INC DE</td>
<td class="comment-1" rowspan="2">Move onto the next cashbox (loop back to <a href="CC9B.html#ccdd">Cashboxescomplete_Loop</a>) or continue once all 12 are checked.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce1"></span>CCE1</td>
<td class="instruction">DJNZ <a href="CC9B.html#ccdd">Cashboxescomplete_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce3"></span>CCE3</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-1" rowspan="2">Write <span class="register">A</span> (01) to <a href="C9B7.html#ca80">Cashboxes_Completed_Flag</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce4"></span>CCE4</td>
<td class="instruction">RET</td>
</tr>
<tr>
<td class="asm-label">Draw_GameCashbox</td>
<td class="address-2"><span id="cce5"></span>CCE5</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="10">Determines whether to send <a href="FF78.html">EmptyBox_Image</a> or <a href="FF78.html#ff98">DollarBox_Image</a> to <a href="D5E6.html">Copy_Routine</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce6"></span>CCE6</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce7"></span>CCE7</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cce8"></span>CCE8</td>
<td class="instruction">LD DE,$FF78</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cceb"></span>CCEB</td>
<td class="instruction">LD A,(IX+$00)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccee"></span>CCEE</td>
<td class="instruction">AND A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccef"></span>CCEF</td>
<td class="instruction">JR Z,<a href="CC9B.html#ccf4">$CCF4</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccf1"></span>CCF1</td>
<td class="instruction">LD DE,$FF98</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-2"><span id="ccf4"></span>CCF4</td>
<td class="instruction">LD BC,$1002</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccf7"></span>CCF7</td>
<td class="instruction">CALL <a href="D5E6.html">Copy_Routine</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccfa"></span>CCFA</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ccfb"></span>
<div class="comments">
<div class="paragraph">
Draws all the cashboxes in two blocks of 6.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">Draw_GameCashboxes</td>
<td class="address-2"><span id="ccfb"></span>CCFB</td>
<td class="instruction">LD IX,$CC8D</td>
<td class="comment-1" rowspan="16">The statuses for the cashboxes begin at <a href="CC8D.html">DoorDeposited_01</a>. This routine processes them in two blocks of 6 (as they appear. The first block is displayed at $401F, after processing the subroutine returns and continues for the next six blocks, just altering the screen location to $4025.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ccff"></span>CCFF</td>
<td class="instruction">LD HL,$401F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd02"></span>CD02</td>
<td class="instruction">LD A,$01</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd04"></span>CD04</td>
<td class="instruction">CALL <a href="CC9B.html#cd0a">Draw_GameCashboxes_Skip</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd07"></span>CD07</td>
<td class="instruction">LD HL,$4025</td>
</tr>
<tr>
<td class="asm-label">Draw_GameCashboxes_Skip</td>
<td class="address-2"><span id="cd0a"></span>CD0A</td>
<td class="instruction">LD B,$06</td>
</tr>
<tr>
<td class="asm-label">Draw_GameCashboxes_Loop</td>
<td class="address-2"><span id="cd0c"></span>CD0C</td>
<td class="instruction">PUSH BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd0d"></span>CD0D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd0e"></span>CD0E</td>
<td class="instruction">PUSH AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd0f"></span>CD0F</td>
<td class="instruction">CALL <a href="CC9B.html#cce5">Draw_GameCashbox</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd12"></span>CD12</td>
<td class="instruction">POP AF</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd13"></span>CD13</td>
<td class="instruction">POP HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd14"></span>CD14</td>
<td class="instruction">POP BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd15"></span>CD15</td>
<td class="instruction">INC IX</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd17"></span>CD17</td>
<td class="instruction">INC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd18"></span>CD18</td>
<td class="instruction">DJNZ <a href="CC9B.html#cd0c">Draw_GameCashboxes_Loop</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cd1a"></span>CD1A</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CC99.html">CC99</a>
</td>
<td class="up">Up: <a href="../maps/all.html#cc9b">Map</a></td>
<td class="next">
Next: <a href="CD1B.html">CD1B</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; DINAMIC SOFTWARE 1985 &copy; 2023 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.10.</div>
<div><a href="../dec/asm/52379.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>